# F1T 系統參數同步機制文檔

## 📋 術語標準化
- **修改日期**: 2025-08-27
- **術語更新**: "參數聯動" → "參數同步"
- **適用範圍**: 全系統界面、設定頁面、技術文檔

## 🎯 參數同步定義

### 🔄 **參數同步 (Parameter Synchronization)**
指系統中所有模組、對話框、設定頁面之間的核心參數保持一致性的機制。

#### 核心同步參數
- **年份 (Year)**: 2025
- **賽事 (Race)**: Japan  
- **賽段 (Session)**: R (Race)
- **主要駕駛員**: VER (Max Verstappen)
- **次要駕駛員**: LEC (Charles Leclerc)

## 🏗️ 同步架構層級

### 1. 🎛️ **主程式同步中心**
- **功能**: 作為參數同步的中央控制點
- **責任**: 維護全系統的參數一致性
- **機制**: 通過事件總線分發參數變更

### 2. 🔧 **模組參數同步**
- **賽道分析模組**: 自動同步年份、賽事、賽段參數
- **電壓分析模組**: 繼承主程式的基礎參數設定
- **其他分析模組**: 統一使用同步後的參數配置

### 3. 📋 **設定頁面同步**
- **電壓設定對話框**: 顯示當前同步的參數值
- **分析參數設定**: 實時反映主程式的參數狀態
- **系統配置頁面**: 提供參數同步狀態檢查

## 🔄 同步機制實現

### ✅ **即時同步**
```python
# 主程式參數變更時
def update_global_parameters(year, race, session):
    # 1. 更新主程式狀態
    self.current_year = year
    self.current_race = race
    self.current_session = session
    
    # 2. 同步到所有子模組
    self.sync_parameters_to_modules()
    
    # 3. 更新設定頁面顯示
    self.sync_parameters_to_dialogs()
```

### ✅ **模組初始化同步**
```python
# 新模組啟動時自動同步
def init_module_with_sync(module_instance):
    # 從主程式獲取當前參數
    sync_params = self.get_current_sync_parameters()
    
    # 應用到新模組
    module_instance.apply_sync_parameters(sync_params)
```

### ✅ **設定對話框同步**
```python
# 設定對話框顯示同步狀態
def show_sync_status_in_dialog():
    year_label.setText(f"年份: {self.sync_year}")
    race_label.setText(f"賽事: {self.sync_race}")
    session_label.setText(f"賽段: {self.sync_session}")
    status_label.setText("✅ 參數同步正常")
```

## 📊 同步驗證機制

### 🔍 **同步狀態檢查**
1. **主程式啟動時**: 驗證所有模組參數一致性
2. **模組載入時**: 確認參數與主程式同步
3. **設定變更時**: 即時檢查同步完成狀態
4. **系統運行中**: 定期驗證參數同步健康度

### 📈 **同步品質指標**
- **一致性**: 所有模組使用相同的基礎參數
- **即時性**: 參數變更後立即同步到所有組件
- **可靠性**: 同步失敗時有自動恢復機制
- **可視性**: 用戶可以清楚看到同步狀態

## 🎯 應用場景示例

### 場景1: 用戶變更年份設定
```
主程式 → 年份改為2024 → 自動同步到：
├── 賽道分析模組 (重新載入2024數據)
├── 電壓分析模組 (更新2024參數)
├── 設定對話框 (顯示2024年份)
└── 狀態列 (更新為2024狀態)
```

### 場景2: 開啟新的分析模組
```
新模組啟動 → 自動獲取同步參數：
├── 年份: 2025 (從主程式同步)
├── 賽事: Japan (從主程式同步)
├── 賽段: R (從主程式同步)
└── 狀態: 參數同步完成 ✅
```

### 場景3: 設定對話框開啟
```
設定對話框 → 顯示當前同步狀態：
├── 年份欄位: 2025 (已同步)
├── 賽事欄位: Japan (已同步)
├── 賽段欄位: R (已同步)
└── 同步狀態: "✅ 參數同步正常"
```

## 🔧 同步機制優勢

### 🌟 **用戶體驗提升**
- **一致性保證**: 所有界面顯示相同的參數值
- **操作簡化**: 不需要在每個模組重複設定
- **狀態透明**: 清楚顯示當前的參數同步狀態
- **錯誤減少**: 避免模組間參數不一致導致的問題

### 🌟 **開發維護優勢**
- **中央管理**: 參數變更只需在一個地方處理
- **模組解耦**: 各模組專注於自身功能，參數由同步機制提供
- **錯誤追蹤**: 集中的同步機制便於問題診斷
- **擴展性強**: 新增模組可輕鬆接入同步系統

## 📋 實現狀態

### ✅ **已實現功能**
- [x] 主程式到模組的參數同步
- [x] 設定對話框的同步狀態顯示
- [x] 賽道分析模組的自動同步
- [x] 電壓分析模組的參數承繼

### 🔄 **持續改進項目**
- [ ] 同步失敗時的自動重試機制
- [ ] 參數變更歷史記錄功能
- [ ] 跨會話的參數持久化同步
- [ ] 多用戶環境下的同步隔離

## 🚀 未來擴展

### 📈 **高級同步功能**
1. **智能同步**: 根據模組類型選擇性同步相關參數
2. **批量同步**: 一次性同步多個參數集合
3. **同步驗證**: 參數變更前的相容性檢查
4. **同步回滾**: 同步失敗時恢復到上一個穩定狀態

---

## 📝 總結

**參數同步機制**是F1T系統的核心基礎設施，確保所有模組、對話框、設定頁面之間保持參數一致性。這不僅提升了用戶體驗，也大大簡化了系統的維護和擴展工作。

通過標準化的同步術語和機制，F1T系統建立了一個可靠、高效、易維護的參數管理體系。
